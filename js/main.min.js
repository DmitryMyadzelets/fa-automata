(function(){var A,e,o,m,w,v,c,g,f,a,p,t,z,s,q,l,k,d,u,n,h,b,j,i;j=i=0;o=null;e=null;this.graph=faxy.create();h=null;this.pack=function(B,C){return((B&65535)<<16)|(C&65535);
};this.unpack=function(x){return[(x>>16)&65535,x&65535];};q=function(B){var x,y;if(!($&&$.jStorage&&$.jStorage.storageAvailable()&&JSON)){return false;
}x=(y=JSON.parse($.jStorage.get("graph")))!=null?y:{};return B.nodes.length>0;};u=function(x){if(!($&&$.jStorage&&$.jStorage.storageAvailable())){return false;
}return $.jStorage.set("graph",JSON.stringify(x));};m={dx:0,dy:0};l=function(J,I,F){var D,B,H,C,G,E;C=J.nodes.x;for(D=B=0,H=C.length;B<H;D=++B){G=C[D];
E=J.nodes.y[D];m.dx=I-G;m.dy=F-E;if((m.dx*m.dx)+(m.dy*m.dy)<(r*r)){return D;}}return -1;};n=d=0;k=-1;z=false;p={node_ix:0,x:0,y:0};A=function(H,I){var K,J,G,F,E,D,C,B,y,x;
switch(d=n){case 0:if(1===H){G=t(I),j=G[0],i=G[1];k=l(graph,j,i);if(k>=0){if(!I.shiftKey){p.node_ix=k;n=2;}else{p.x=graph.nodes.x[k];p.y=graph.nodes.y[k];
n=1;}}else{if(I.shiftKey){p.x=j;p.y=i;n=4;}else{p.x=j;p.y=i;n=5;}}}break;case 1:switch(H){case 2:F=t(I),j=F[0],i=F[1];if((j-=m.dx)<0){j=0;}if((i-=m.dy)<0){i=0;
}editor.nodes.move(graph,k,j,i);break;case 3:editor.nodes.move2(graph,k,p.x,p.y,j,i);z=true;n=0;break;default:graph.nodes.x[k]=p.x;graph.nodes.y[k]=p.y;
n=0;}o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);break;case 2:switch(H){case 2:E=t(I),j=E[0],i=E[1];k=l(graph,j,i);if(k!==p.node_ix){p.x=graph.nodes.x[p.node_ix];
p.y=graph.nodes.y[p.node_ix];n=3;}break;default:n=0;}break;case 3:D=t(I),j=D[0],i=D[1];k=l(graph,j,i);switch(H){case 2:o.clearRect(0,0,e.width,e.height);
draw.automaton(o,graph);draw.fake_edge(o,faxy.get_fake_edge(graph,p.node_ix,k,j,i));break;case 3:if(k<0){editor.commands.start_transaction();k=editor.nodes.add(graph,j,i);
editor.edges.add(graph,p.node_ix,k);editor.commands.stop_transaction();}else{editor.edges.add(graph,p.node_ix,k);}z=true;o.clearRect(0,0,e.width,e.height);
draw.automaton(o,graph);n=0;break;default:o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);n=0;}break;case 4:switch(H){case 2:C=t(I),j=C[0],i=C[1];
o.save();o.clearRect(0,0,e.width,e.height);o.translate(j-p.x,i-p.y);draw.automaton(o,graph);o.restore();break;case 3:B=t(I),j=B[0],i=B[1];o.clearRect(0,0,e.width,e.height);
draw.automaton(o,graph);z=true;n=0;break;default:o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);n=0;}break;case 5:switch(H){case 3:y=t(I),j=y[0],i=y[1];
editor.nodes.add(graph,j,i);o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);z=true;n=0;break;case 2:x=t(I),j=x[0],i=x[1];K=j-p.x;J=i-p.y;K*=K;
J*=J;if((K>4)||(J>4)){n=0;}break;default:n=0;}}if(d!==n){console.log(H+": "+d+"->"+n);if(0===n){if(z){u(graph);z=false;}}}return null;};s=function(){var y,x;
e=document.getElementById("myCanvas");e.focus();o=e.getContext("2d");o.fillStyle="gray";o.lineWidth=1.2;o.strokeStyle="rgba(0,0,255,0.5)";o.font="12pt Tahoma";
o.textAlign="left";e.addEventListener("mousedown",c,false);e.addEventListener("mouseup",f,false);e.addEventListener("mousemove",g,false);e.addEventListener("keypress",w,false);
e.addEventListener("keyup",v,false);e.addEventListener("dragstart",function(B){return B.preventDefault();},false);e.onselectstart=function(){return false;
};if(!q(graph)){y=editor.nodes.add(graph,-50+e.width/2,e.height/2);x=editor.nodes.add(graph,50+e.width/2,e.height/2);editor.edges.add(graph,y,x);editor.edges.add(graph,x,x);
}draw.automaton(o,graph);h=document.getElementById("label_editor2");h.onfocus=function(){h.value="some text";console.log("onfocus");return null;};h.onblur=function(){h.value="";
h.style.display="none";console.log("offocus");return null;};h.oninput=function(){console.log(h.value);return null;};return null;};t=function(x){var y;y=e.getBoundingClientRect();
return[x.clientX-y.left,x.clientY-y.top];};window.onload=function(){s();return null;};c=function(x){A(1,x);return null;};g=function(x){A(2,x);return null;
};f=function(x){A(3,x);return null;};w=function(x){if(x.ctrlKey){switch(x.keyCode){case 25:editor.redo();o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);
u(graph);break;case 26:editor.undo();o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);u(graph);}}return null;};v=function(x){switch(x.keyCode){case 46:editor.nodes.del(graph,graph.nodes.length-1);
o.clearRect(0,0,e.width,e.height);draw.automaton(o,graph);u(graph);break;case 81:editor.edges.del(graph,graph.edges.length-1);o.clearRect(0,0,e.width,e.height);
draw.automaton(o,graph);break;}return null;};(b=function(){console.log(".");return setTimeout(b,1000);})();a=function(){var x,B,C,y;({dependent:{}});B=function(F){var D,E;
E=[];for(D in F){if(F[D] instanceof Array){E.push(D);}}return E;};x=function(J,K,F){var G,H,E,I,D;H=this.get_arrays(J);for(I=0,D=H.length;I<D;I++){G=H[I];
E=K(J[G],F);}return E;};for(y in Float32Array){C=Float32Array[y];this[y]=C;}a=function(){return{add:function(D,E){if(E!=null){if(E>-1&&E<this.length){this.push(this[E]);
this[E]=D;this.for_arrays_of(this,function(F){F.push(F[E]);return F[E]=null;});}}else{this.push(D);this.for_arrays_of(this,function(F){return F.push(null);
});}return this.length;},del:function(E){var D;if(E<this.length-1){D=this.splice(E,1,this.pop());this.for_arrays_of(this,function(F){return F.splice(E,1,F.pop());
});}else{D=this.splice(E,1);this.for_arrays_of(this,function(F){return F.splice(E,1);});}this.for_arrays_of(this.dependent,function(H){var G,F;G=H.length;
F=[];while(G-->0){if(H[G]===E){F.push(H.del(G));}else{F.push(void 0);}}return F;});return D;}};};return a;};this.nodes=new a;nodes.prop=[];nodes.add(8);
nodes.add(5);nodes.prop[1]="test2";this.trans=new a;trans.add(1);nodes.dependent.trans=trans;console.log(nodes);console.log(trans);console.log(states.del(0));
console.log(trans);}).call(this);